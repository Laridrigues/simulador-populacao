// script.js

// Variáveis do DOM
const btnSimular = document.getElementById("btnSimular");
const btnReset = document.getElementById("btnReset");

const populacaoAInput = document.getElementById("populacaoA");
const populacaoBInput = document.getElementById("populacaoB");
const taxaAInput = document.getElementById("taxaA");
const taxaBInput = document.getElementById("taxaB");

const diasTotal = document.getElementById("diasTotal");
const diasTotalText = document.getElementById("diasTotalText");
const paisVencedor = document.getElementById("paisVencedor");
const paisPerdedor = document.getElementById("paisPerdedor");

const popAfinal = document.getElementById("populacaoAFinal");
const popBfinal = document.getElementById("populacaoBFinal");
const crescimentoAEl = document.getElementById("crescimentoA");
const crescimentoBEl = document.getElementById("crescimentoB");

const resultsPanel = document.getElementById("resultsPanel");
const chartPanel = document.getElementById("chartPanel");
const ctx = document.getElementById("growthChart").getContext("2d");

let growthChart;

// Função principal
btnSimular.addEventListener("click", () => {
    // Leitura dos inputs
    let popA = Number(populacaoAInput.value);
    let popB = Number(populacaoBInput.value);
    let taxaA = Number(taxaAInput.value);
    let taxaB = Number(taxaBInput.value);

    // VALIDAÇÕES
    if (popA <= 0 || popA > 1_000_000_000 || popB <= 0 || popB > 1_000_000_000) {
        alert("População deve estar entre 1.000 e 1.000.000.000 habitantes.");
        return;
    }
    if (taxaA < -1 || taxaA > 5 || taxaB < -1 || taxaB > 5) {
        alert("Taxas de crescimento devem estar entre -1% e 5% ao ano.");
        return;
    }

    // Definindo nomes dos países
    const nomePaisA = document.getElementById("nomePaisA").value || "Primeiro país";
    const nomePaisB = document.getElementById("nomePaisB").value || "Segundo país";

    // Inicialização
    let anos = 0;
    const maxAnos = 500; // Limite para evitar loop infinito
    const historicoA = [popA];
    const historicoB = [popB];

    // Caso já ultrapassado no ano 0
    if (popA >= popB) {
        diasTotal.innerText = "0 anos";
        diasTotalText.innerText = "0";
        paisVencedor.innerText = nomePaisA;
        paisPerdedor.innerText = nomePaisB;
    } else {
        // Simulação ano a ano
        while (popA < popB && anos < maxAnos) {
            popA = popA * (1 + taxaA / 100);
            popB = popB * (1 + taxaB / 100);
            historicoA.push(popA);
            historicoB.push(popB);
            anos++;
        }

        diasTotal.innerText = `${anos} anos`;
        diasTotalText.innerText = anos;
        paisVencedor.innerText = popA >= popB ? nomePaisA : nomePaisB;
        paisPerdedor.innerText = popA >= popB ? nomePaisB : nomePaisA;
    }

    // Resultados finais
    popAfinal.innerText = Math.round(popA).toLocaleString();
    popBfinal.innerText = Math.round(popB).toLocaleString();
    crescimentoAEl.innerText = taxaA + "%";
    crescimentoBEl.innerText = taxaB + "%";

    // Exibir painel de resultados
    resultsPanel.classList.remove("hidden");
    chartPanel.classList.remove("hidden");

    // Atualizar gráfico
    if (growthChart) growthChart.destroy();
    growthChart = new Chart(ctx, {
        type: "line",
        data: {
            labels: Array.from({ length: historicoA.length }, (_, i) => i),
            datasets: [
                {
                    label: nomePaisA,
                    data: historicoA,
                    borderColor: "rgba(54, 162, 235, 1)",
                    backgroundColor: "rgba(54, 162, 235, 0.2)",
                    tension: 0.3
                },
                {
                    label: nomePaisB,
                    data: historicoB,
                    borderColor: "rgba(255, 99, 132, 1)",
                    backgroundColor: "rgba(255, 99, 132, 0.2)",
                    tension: 0.3
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: "top" },
                title: {
                    display: true,
                    text: "Crescimento Populacional ao Longo dos Anos"
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function (value) {
                            return value.toLocaleString();
                        }
                    }
                },
                x: { title: { display: true, text: "Ano" } }
            }
        }
    });
});

// Botão reset
btnReset.addEventListener("click", () => {
    populacaoAInput.value = 100_000_000;
    populacaoBInput.value = 5_000_000;
    taxaAInput.value = 0.6;
    taxaBInput.value = 0.8;
    resultsPanel.classList.add("hidden");
    chartPanel.classList.add("hidden");
    if (growthChart) growthChart.destroy();
});
